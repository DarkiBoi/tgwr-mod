add_namespace = ww1_bruderkrieg

# AFTERMATH OF BRUDERKRIEG
############################
country_event = {
	id = ww1_bruderkrieg.1
	title = ww1_bruderkrieg.1.t
	desc = ww1_bruderkrieg.1.d
	picture = GFX_report_event_military_planning
	fire_only_once = yes
	is_triggered_only = yes
	option = {
		name = ww1_bruderkrieg.1.a
		ai_chance = { factor = 100 }
		every_country = {
			limit = {
				has_war_with = AUH
			}
			hidden_effect = {
				set_country_flag = bruderkrieg_winner
			}
			white_peace = AUH
		}
		every_state = {
			limit = {
				OR = {
					is_core_of = AUH
					is_claimed_by = AUH
					is_core_of = GAL
				}
			}
			remove_core_of = AUH
			remove_core_of = GAL
			remove_claim_by = AUH
		}
		every_state = {
			limit = {
				is_owned_by = AUH
				is_claimed_by = GER
			}
			GER = {
				transfer_state = PREV
			}
		}
		if = {
			limit = {
				ITA = {
					has_country_flag = bruderkrieg_winner
				}
			}
			every_state = {
				limit = {
					OR = {
						is_owned_by = AUH
						is_owned_by = CRO
					}
					OR = {
						is_core_of = ITA
						is_claimed_by = ITA
					}
				}
				ITA = {
					transfer_state = PREV
				}
			}
		}
		every_state = {
			limit = {
				is_owned_by = AUH
				OR = {
					is_core_of = TRA
					is_core_of = ROM
					is_core_of = MOL
				}
			}
			if = {
				limit = {
					ROM = {
						has_country_flag = bruderkrieg_winner
					}
				}
				remove_core_of = HUN
				ROM = {
					add_state_core = PREV
					transfer_state = PREV
					annex_country = {
						target = TRA
						transfer_troops = yes
					}
					annex_country = {
						target = MOL
						transfer_troops = yes
					}
				}
			}
			else = {
				HUN = {
					transfer_state = PREV
					annex_country = {
						target = TRA
						transfer_troops = no
					}
				}
				ROM = {
					transfer_state = 80
				}
			}
		}
		every_state = {
			limit = {
				is_owned_by = AUH
				OR = {
					is_core_of = CRO
					is_core_of = BOS
					is_core_of = SER
					is_core_of = SLV
				}
			}
			CRO = {
				add_state_core = PREV
				transfer_state = PREV
			}
		}
		every_state = {
			limit = {
				is_owned_by = AUH
				is_core_of = CZE
			}
			CZE = {
				add_state_core = PREV
				transfer_state = PREV
				load_oob = CZE_1918
			}
		}
		every_state = {
			limit = {
				is_owned_by = AUH
				is_core_of = UKR
				NOT = {
					state = 237 # Lemberg
					state = 73 # Carpathian Ruthenia
				}
			}
			WUK = {
				add_state_core = PREV
				transfer_state = PREV
			}
		}
		every_state = {
			limit = {
				is_owned_by = AUH
				is_core_of = POL
			}
			POL = {
				add_state_core = PREV
				transfer_state = PREV
			}
		}
		every_state = {
			limit = {
				is_owned_by = AUH
				OR = {
					is_core_of = HUN
					is_core_of = SLO
				}
			}
			HUN = {
				transfer_state = PREV
			}
		}
		AUH = {
			transfer_navy = {
				target = GER
			}
		}
		annex_country = {
			target = AUH
			transfer_troops = no
		}
	}
}

# CROATIAN REVOLTS
####################
country_event = {
	id = ww1_bruderkrieg.2
	title = ww1_bruderkrieg.2.t
	desc = ww1_bruderkrieg.2.d
	trigger = {
		original_tag = AUH
		has_war_with = GER
		OR = {
			has_idea = AUH_croatian_separatism
			has_idea = AUH_croatian_separatism2
		}
		NOT = {
			has_country_flag = great_war_loser
			has_country_flag = croatia_released
		}
	}
	fire_only_once = yes
	mean_time_to_happen = {
		days = 15
	}
	option = {
		name = ww1_bruderkrieg.2.a
		ai_chance = { factor = 100 }
		hidden_effect = {
			set_country_flag = croatia_released
			remove_ideas = AUH_croatian_separatism
			remove_ideas = AUH_croatian_separatism2
		}
		every_owned_state = {
			limit = {
				OR = {
					is_core_of = CRO
					is_core_of = BOS
					is_core_of = SER
				}
				NOT = {
					state = 82 # Banat
					state = 764 # West Banat
					state = 45 # Voyvoda
				}
			}
			remove_core_of = AUH
			add_claim_by = AUH
			CRO = {
				add_state_core = PREV
				transfer_state = PREV
			}
		}
		every_state = {
			limit = {
				is_core_of = SLV
			}
			add_core_of = CRO
		}
		end_puppet = CRO
		CRO = {
			hidden_effect = {
				load_oob = CRO_1918
			}
			set_cosmetic_tag = CRO_SSCS
			create_country_leader = {
				name = "Anton Korošec"
				picture = "gfx/leaders/SLV/SLV_Anton_Korosec.dds"
				expire = "1935.1.1"
				ideology = authoritarian_democracy
				traits = { trait_authoritarian_democracy }
			}
			create_country_leader = {
				name = "Anton Korošec"
				picture = "gfx/leaders/SLV/SLV_Anton_Korosec.dds"
				expire = "1935.1.1"
				ideology = conservatism
				traits = { trait_conservatism }
			}
		}
		declare_war_on = {
			target = CRO
			type = annex_everything
		}
	}
}

# POLISH AND UKRAINIAN REVOLT
country_event = {
	id = ww1_bruderkrieg.3
	title = ww1_bruderkrieg.3.t
	desc = ww1_bruderkrieg.3.d
	trigger = {
		original_tag = AUH
		has_war_with = GER
		OR = {
			has_idea = AUH_polish_separatism
			has_idea = AUH_polish_separatism2
		}
		NOT = {
			has_country_flag = great_war_loser
			has_country_flag = galicia_released
		}
	}
	fire_only_once = yes
	mean_time_to_happen = {
		days = 30
	}
	option = {
		name = ww1_bruderkrieg.3.a
		ai_chance = { factor = 100 }
		hidden_effect = {
			set_country_flag = galicia_released
			remove_ideas = AUH_polish_separatism
			remove_ideas = AUH_polish_separatism2
		}
		every_owned_state = {
			limit = {
				is_core_of = UKR
				NOT = {
					state = 237 #Lemberg
					state = 73 #Carpathian Ruthenia
				}
			}
			remove_core_of = AUH
			add_claim_by = AUH
			WUK = {
				add_state_core = PREV
				transfer_state = PREV
			}
		}
		every_owned_state = {
			limit = {
				is_core_of = POL
				NOT = {
					state = 72 # Zaolzie
				}
			}
			remove_core_of = AUH
			add_claim_by = AUH
			POL = {
				add_state_core = PREV
				transfer_state = PREV
			}
		}
		POL = {
			division_template = {
				name = "Bojówki"
				regiments = {
					infantry = {
						x = 0
						y = 0
					}
					infantry = {
						x = 0
						y = 1
					}
					infantry = {
						x = 0
						y = 2
					}
					infantry = {
						x = 0
						y = 3
					}
					infantry = {
						x = 1
						y = 0
					}
					infantry = {
						x = 1
						y = 1
					}
					infantry = {
						x = 1
						y = 2
					}
				}
			}
			random_owned_controlled_state = {
				limit = {
					is_core_of = POL
				}
				prioritize = { 88 }
				create_unit = {
					division = "name = \"Pułk Bojowników\" division_template = \"Bojówki\" start_experience_factor = 0.4" 
					owner = PREV
				}
				create_unit = {
					division = "name = \"Pułk Bojowników\" division_template = \"Bojówki\" start_experience_factor = 0.4" 
					owner = PREV
				}
				create_unit = {
					division = "name = \"Pułk Bojowników\" division_template = \"Bojówki\" start_experience_factor = 0.4" 
					owner = PREV
				}
			}
		}
		declare_war_on = {
			target = WUK
			type = annex_everything
		}
		declare_war_on = {
			target = POL
			type = annex_everything
		}
	}
}

# ROMANIAN REVOLT
country_event = {
	id = ww1_bruderkrieg.4
	title = ww1_bruderkrieg.4.t
	desc = ww1_bruderkrieg.4.d
	trigger = {
		original_tag = AUH
		has_war_with = GER
		any_owned_state = {
			OR = {
				is_core_of = ROM
				is_core_of = TRA
				is_core_of = MOL
			}
		}
		NOT = {
			has_country_flag = great_war_loser
			country_exists = TRA
		}
	}
	fire_only_once = yes
	mean_time_to_happen = {
		days = 45
	}
	option = {
		name = ww1_bruderkrieg.4.a
		ai_chance = { factor = 100 }
		every_owned_state = {
			limit = {
				is_core_of = TRA
			}
			remove_core_of = AUH
			remove_core_of = HUN
			add_claim_by = AUH
			add_claim_by = HUN
			TRA = {
				transfer_state = PREV
			}
		}
		every_owned_state = {
			limit = {
				is_core_of = MOL
			}
			remove_core_of = AUH
			add_claim_by = AUH
			MOL = {
				transfer_state = PREV
			}
		}
		declare_war_on = {
			target = TRA
			type = annex_everything
		}
		declare_war_on = {
			target = MOL
			type = annex_everything
		}
	}
}

# GERMANY LOST
####################
country_event = {
	id = ww1_bruderkrieg.5
	title = ww1_bruderkrieg.5.t
	desc = ww1_bruderkrieg.5.d
	is_triggered_only = yes
	fire_only_once = yes
	immediate = {
		hidden_effect = {
			if = {
				limit = {
					ITA = {
						has_war_with = AUH
					}
				}
				ITA = {
					set_major = yes
				}
			}
			GER = {
				dismantle_faction = yes
				white_peace = AUH
			}
			set_global_flag = brothers_war_ends
		}
		every_state = {
			limit = {
				is_owned_by = GER
				NOT = { is_core_of = GER }
			}
			AUH = { transfer_state = PREV }
		}
		if = {
			limit = {
				has_dlc = "Together for Victory"
			}
			set_autonomy = {
				target = GER
				autonomous_state = autonomy_dominion
			}
		}
		else = {
			puppet = GER
		}
		GER = {
			set_cosmetic_tag = GER_confederation
			create_country_leader = {
				name = "Frankfurt Parliament"
				picture = "gfx/leaders/GER/GER_Frankfurt_Parliament.dds"
				expire = "1935.1.1"
				ideology = oligarchism
				traits = {
					trait_oligarchism
				}
			}
			set_capital = 55
			set_party_name = { 
				ideology = neutrality
				long_name = GER_frankfurt_parliament
				name = GER_frankfurt_parliament
			}
		}
		create_faction = central_powers
	}
	option = {
		ww1_bruderkrieg.1.a
		ai_chance = {
			factor = 100
		}
	}
}